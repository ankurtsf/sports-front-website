export const config = {
    runtime: 'edge',
};

export default async function handler(req) {
    // 1. Get the user's message
    const { messages } = await req.json();
    const userMessage = messages[messages.length - 1].content;

    // 2. Define the Knowledge Base (The Impact Report Data)
    const systemPrompt = `
    You are the official AI Assistant for 'The Sports Front'. 
    Your goal is to excite fans, inform partners, and promote upcoming events.
    
    Here is your Knowledge Base (Internal Data):
    
    [PAST EVENT: LEGENDS FACE OFF - MUMBAI]
    - Date: April 6, 2025.
    - Venue: DY Patil Stadium.
    - Match: Real Madrid Legends vs Barcelona Legends.
    - Attendance: 30,231+ Live.
    - Digital Reach: 20 Million+.
    - PR Value: â‚¹62 Crores generated.
    - Sponsors: HSBC (Banking), Jameson (Co-Sponsor), BMW (Mobility), Budweiser, Bisleri, Pavilions & Interiors, District, JioStar, Fairmont, Nivia, Medulance, DY Patil, Capital Group, Event Network, FlixBus, Red FM, Topps.
    
    [UPCOMING ROADMAP 2026]
    1. "The Northern Storm" (India, Q1 2026): Manchester United Legends vs Manchester City Legends. 
    2. "Kings of Europe" (Thailand, Q2 2026): Real Madrid Legends vs Barcelona Legends.
    
    [TEAM LEADERSHIP]
    - Core Team: John, Anirudh, Ankur.
    
    [CONTACT INFO]
    - Email: info@thesportsfront.com
    - Location: Delhi, India.
    
    [STRICT GUARDRAILS]
    - NEVER disclose financial margins, operational costs, or private phone numbers.
    - If asked about ticket prices for 2026, say: "Tickets are not live yet. Join the Priority List on our site."
    - If asked for sponsorship, say: "Please fill out the Request Impact Report form below."
    - Keep answers short, punchy, and professional.
    `;

    // 3. Call Google Gemini API
    const apiKey = "AIzaSyBH1s4pAWbviex1VBylXxMD0P7XeOXB9uA"; 
    
    if (!apiKey) {
        return new Response(JSON.stringify({ error: "API Key missing" }), { status: 500 });
    }

    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            contents: [
                { role: "user", parts: [{ text: systemPrompt + "\n\nUser Question: " + userMessage }] }
            ]
        })
    });

    const data = await response.json();
    const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "I'm having trouble connecting to the stadium. Please try again.";

    return new Response(JSON.stringify({ reply }), {
        headers: { 'Content-Type': 'application/json' },
    });
}